<!-- Material Body Table -->
<div class="w3-bar w3-border" style="display: flex; justify-content: center; margin-top: 16px;">
    <span class="w3-bar-item">PEMAKAIAN MATERIAL BODY</span>
</div>

<div class="w3-tiny">
    <table class="tg" style="width: 100%;" id="tableMaterialBody" data-worksheet-id="<?= $worksheet_id ?>">
        <thead>
        <tr>
            <th class="tg-ncfi w3-tiny"></th>
            <th class="tg-ncfi w3-tiny">MAIN BODY</th>
            <th class="tg-ncfi w3-tiny">VARIASI 1</th>
            <th class="tg-ncfi w3-tiny">VARIASI 2</th>
            <th class="tg-ncfi w3-tiny">VARIASI 3</th>
            <th class="tg-ncfi w3-tiny">VARIASI 4</th>
            <th class="tg-ncfi w3-tiny">VARIASI 5</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td contenteditable class="tg-0lax w3-tiny">Fabric<br>Description</td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr>
            <td contenteditable class="tg-0lax w3-tiny">LOCATION</td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr class="w3-pale-yellow">
            <td contenteditable class="tg-0lax w3-tiny">Est. CONS</td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>

        <tr>
            <td contenteditable colspan="7" class="tg-0lax w3-tiny w3-center" style="border-bottom: 2px solid black;"></td>
        </tr>

        <tr>
            <td contenteditable class="tg-0lax w3-tiny">BODY 1</td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr>
            <td contenteditable class="tg-0lax w3-tiny">Total Est. CONS</td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr>
            <td contenteditable class="tg-0lax w3-tiny">UNIT</td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr class="w3-pale-green" style="border-bottom: 2px solid black !important;">
            <td contenteditable class="tg-0lax w3-tiny">HAL. KAIN</td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>

        <tr>
            <td contenteditable class="tg-0lax w3-tiny">BODY 2</td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr>
            <td contenteditable class="tg-0lax w3-tiny">Total Est. CONS</td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr>
            <td contenteditable class="tg-0lax w3-tiny">UNIT</td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr class="w3-pale-green" style="border-bottom: 2px solid black !important;">
            <td contenteditable class="tg-0lax w3-tiny">HAL. KAIN</td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>

        <tr>
            <td contenteditable class="tg-0lax w3-tiny">BODY 3</td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr>
            <td contenteditable class="tg-0lax w3-tiny">Total Est. CONS</td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr>
            <td contenteditable class="tg-0lax w3-tiny">UNIT</td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr class="w3-pale-green" style="border-bottom: 2px solid black !important;">
            <td contenteditable class="tg-0lax w3-tiny">HAL. KAIN</td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        </tbody>
    </table>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get all the editable cells in the table
        const cells = document.querySelectorAll('#tableMaterialBody tbody td[contenteditable]');

        // Loop through each cell and attach event listeners
        cells.forEach(function(cell) {
            cell.addEventListener('input', function() {
                const worksheetId = document.querySelector('#tableMaterialBody').dataset.worksheetId;
                const rowIndex = this.parentNode.rowIndex - 1;
                const columnIndex = this.cellIndex;
                const value = this.textContent;

                // Send an AJAX request to check if the cell already has a value
                const xhr = new XMLHttpRequest();
                xhr.open('POST', 'table/php/04-submit.php');
                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                        if (xhr.status === 200) {
                            // Check the response to determine if the cell already has a value
                            const response = JSON.parse(xhr.responseText);
                            if (response.hasValue) {
                                // Cell already has a value, update the existing value in the table
                                document.querySelector(`#tableMaterialBody tbody tr:nth-child(${rowIndex + 1}) td:nth-child(${columnIndex + 1})`).textContent = value;
                            } else {
                                // Cell is empty, insert the new value into the table
                                // ... insert the code to insert the value into the database here
                            }
                        } else {
                            // Request failed
                            console.error('Error:', xhr.status);
                        }
                    }
                };

                // Send the AJAX request with the cell information
                xhr.send(`worksheetId=${encodeURIComponent(worksheetId)}&rowIndex=${encodeURIComponent(rowIndex)}&columnIndex=${encodeURIComponent(columnIndex)}&value=${encodeURIComponent(value)}`);
            });
        });
    });

</script>

<?php include "php/04-fetch-content.php"; ?>