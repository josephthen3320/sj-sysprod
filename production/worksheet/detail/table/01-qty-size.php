<!-- Qty size table -->
<div class="w3-bar w3-red" style="display: flex; justify-content: center;">
    <span class="w3-bar-item"><b>QUANTITY SIZE BREAKDOWN</b></span>
</div>
<div class="w3-tiny">

    <table class="tg" style="width: 100%;" id="tableQtySize" data-worksheet-id="<?= $worksheet_id ?>">
        <thead>
        <tr>
            <th class="tg-ncfi w3-tiny" rowspan="2">COLOURS</th>
            <th class="tg-ncfi w3-tiny" colspan="5">SIZES</th>
            <th class="tg-ncfi w3-tiny" rowspan="2">TOTAL</th>
            <th class="tg-ncfi w3-tiny" rowspan="2">UNIT<br><span class="w3-tiny">(PCS/SET/DOZ)</span></th>
        </tr>
        <tr>
            <th class="tg-ncfi w3-tiny">S</th>
            <th class="tg-ncfi w3-tiny">M</th>
            <th class="tg-ncfi w3-tiny">L</th>
            <th class="tg-ncfi w3-tiny">XL</th>
            <th class="tg-ncfi w3-tiny">XXL</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td contenteditable class="tg-y6fn w3-tiny">RASIO</td>
            <td contenteditable class="tg-y6fn w3-tiny"></td>
            <td contenteditable class="tg-y6fn w3-tiny"></td>
            <td contenteditable class="tg-y6fn w3-tiny"></td>
            <td contenteditable class="tg-y6fn w3-tiny"></td>
            <td contenteditable class="tg-y6fn w3-tiny"></td>
            <td contenteditable class="tg-y6fn w3-tiny">0</td>
            <td contenteditable class="tg-y6fn w3-tiny"></td>
        </tr>
        <tr>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
            <td contenteditable class="tg-0lax w3-tiny"></td>
        </tr>
        <tr>
            <td class="tg-y6fn"><span style="font-weight:bold">TOTAL</span></td>
            <td contenteditable class="tg-abx8 w3-tiny"></td>
            <td contenteditable class="tg-abx8 w3-tiny"></td>
            <td contenteditable class="tg-abx8 w3-tiny"></td>
            <td contenteditable class="tg-abx8 w3-tiny"></td>
            <td contenteditable class="tg-abx8 w3-tiny"></td>
            <td contenteditable class="tg-abx8 w3-tiny"></td>
            <td contenteditable class="tg-abx8 w3-tiny"></td>
        </tr>
        </tbody>
    </table>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get all the editable cells in the table
        const cells = document.querySelectorAll('#tableQtySize tbody td[contenteditable]');

        // Loop through each cell and attach event listeners
        cells.forEach(function(cell) {
            cell.addEventListener('input', function() {
                const worksheetId = document.querySelector('#tableQtySize').dataset.worksheetId;
                const rowIndex = this.parentNode.rowIndex - 2;
                const columnIndex = this.cellIndex;
                const value = this.textContent;

                // Send an AJAX request to check if the cell already has a value
                const xhr = new XMLHttpRequest();
                xhr.open('POST', 'table/php/01-submit.php');
                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                        if (xhr.status === 200) {
                            // Check the response to determine if the cell already has a value
                            const response = JSON.parse(xhr.responseText);
                            if (response.hasValue) {
                                // Cell already has a value, update the existing value in the table
                                document.querySelector(`#tableQtySize tbody tr:nth-child(${rowIndex + 0}) td:nth-child(${columnIndex + 1})`).textContent = value;
                            } else {
                                // Cell is empty, insert the new value into the table
                                // ... insert the code to insert the value into the database here
                            }
                        } else {
                            // Request failed
                            console.error('Error:', xhr.status);
                        }
                    }
                };

                // Send the AJAX request with the cell information
                xhr.send(`worksheetId=${encodeURIComponent(worksheetId)}&rowIndex=${encodeURIComponent(rowIndex)}&columnIndex=${encodeURIComponent(columnIndex)}&value=${encodeURIComponent(value)}`);
            });
        });
    });

</script>

<script>
    function updateTable() {
        // Make an AJAX request to fetch the latest data
        var xhr = new XMLHttpRequest();
        xhr.open('GET', 'table/php/01-fetch-content.php', true);
        xhr.onload = function() {
            if (xhr.status === 200) {
                // Parse the JSON response
                var data = JSON.parse(xhr.responseText);

                // Update the table cells with the fetched data
                for (var rowIndex in data) {
                    for (var columnIndex in data[rowIndex]) {
                        var value = data[rowIndex][columnIndex];
                        document.querySelector('#tableQtySize tbody tr:nth-child(' + (parseInt(rowIndex) + 0) + ') td:nth-child(' + (parseInt(columnIndex) + 1) + ')').textContent = value;
                    }
                }
            }
        };
        xhr.send();
    }

    // Call the updateTable function initially
    updateTable();

    // Set an interval to update the table periodically
    setInterval(updateTable, 5000); // Update every 5 seconds
</script>

<?php include "php/01-fetch-content.php"; ?>

